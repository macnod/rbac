services:
  rbac:
    image: macnod/rbac-test:latest
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - FORCE_REBUILD=true
    volumes:
      - ../:/rbac/
      - ./logs/:/logs/
    command: >
      ros run -- --disable-debugger --load "/rbac/tests/rbac-test.lisp"
    depends_on:
      - pgtest
  pgtest:
    image: postgres:16
    environment:
      POSTGRES_USER: "cl-user"
      POSTGRES_PASSWORD: "cl-user-password"
      POSTGRES_DB: "rbac"
    ports:
      - "5433:5432"
    volumes:
      - ../init/:/docker-entrypoint-initdb.d/
